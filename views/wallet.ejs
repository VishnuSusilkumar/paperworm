<!DOCTYPE html>

<!-- =========================================================
* Sneat - Bootstrap 5 HTML Admin Template - Pro | v1.0.0
==============================================================
* Product Page: https://themeselection.com/products/sneat-bootstrap-html-admin-template/
* Created by: ThemeSelection
* License: You must have a valid license purchased in order to legally use the theme for your project.
* Copyright ThemeSelection (https://themeselection.com)
=========================================================
 -->
<!-- beautify ignore:start -->
<html
  lang="en"
  class="light-style layout-menu-fixed"
  dir="ltr"
  data-theme="theme-default"
  data-assets-path="../assets/"
  data-template="vertical-menu-template-free"
>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />

    <title>PaperWorm | Wallet</title>

    <link rel="apple-touch-icon" sizes="180x180" href="../template/assets/img/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../template/assets/img/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../template/assets/img/favicons/favicon-16x16.png">
    <link rel="shortcut icon" type="image/x-icon" href="../template/assets/img/favicons/favicon-32x32.png">
    <link rel="manifest" href="../template/assets/img/favicons/manifest.json">
    <meta name="msapplication-TileImage" content="../template/assets/img/favicons/mstile-150x150.png">

    <!--   Template Stylesheets-->
          <!-- ===============================================-->
          <link href="template/assets/css/theme.css" rel="stylesheet" />

     <!-- ===============================================-->
          <!--    Nav Style  -->
          <!-- ===============================================-->
          <link rel="stylesheet" href="../nav/css/linearicons.css">
          <link rel="stylesheet" href="../nav/css/font-awesome.min.css">
          <link rel="stylesheet" href="../nav/css/themify-icons.css">
          <link rel="stylesheet" href="../nav/css/owl.carousel.css">
          <link rel="stylesheet" href="../nav/css/nice-select.css">
          <link rel="stylesheet" href="../nav/css/nouislider.min.css">
          <link rel="stylesheet" href="../nav/css/ion.rangeSlider.css" />
          <link rel="stylesheet" href="../nav/css/ion.rangeSlider.skinFlat.css" />
          <link rel="stylesheet" href="../nav/css/magnific-popup.css">
          <link rel="stylesheet" href="../nav/css/main.css">
      
      
              <!-- ===============================================-->

              <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.14.0/css/all.css"
              integrity="sha384-HzLeBuhoNPvSl5KYnjx0BT+WB0QEEqLprO+NBkkk5gbc67FTaL7XIGa2w1L0Xbgc" crossorigin="anonymous">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
      rel="stylesheet"
    />

    <!-- Icons. Uncomment required icon fonts -->
    <link rel="stylesheet" href="../admin/assets/vendor/fonts/boxicons.css" />

    <!-- Core CSS -->
    <link rel="stylesheet" href="../admin/assets/vendor/css/core.css" class="template-customizer-core-css" />
    <link rel="stylesheet" href="../admin/assets/vendor/css/theme-default.css" class="template-customizer-theme-css" />
    <link rel="stylesheet" href="../admin/assets/css/demo.css" />

    <!-- Vendors CSS -->
    <link rel="stylesheet" href="../admin/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css" />

    <link rel="stylesheet" href="../admin/assets/vendor/libs/apex-charts/apex-charts.css" />



    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">



    <!-- Page CSS -->

    <!-- Helpers -->
    <script src="../admin/assets/vendor/js/helpers.js"></script>

    <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
    <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
    <script src="../admin/assets/js/config.js"></script>
  </head>

  <body>
    <!-- Navbar ============================-->
    <header class="header_area sticky-header">
      <div class="main_menu" style="background-color: #ffffff;">
        <nav class="navbar navbar-expand-lg navbar-light main_box">
          <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <a class="navbar-brand logo_h" href="/"><img class="" src="../nav/img/logo3.png" alt="Bookworm logo" style="width:160px"></a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse offset justify-content-end" id="navbarSupportedContent">
              <ul class="nav navbar-nav menu_nav ml-auto">
                <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
                <li class="nav-item"><a class="nav-link" href="/book">Book</a></li>
                <li class="nav-item active cartText"><a class="nav-link" href="/cart/<%= userDetails._id %>">Cart</a></li>
                <li class="nav-item active cartIcon"><a class="nav-link" href="/cart/<%= userDetails._id %>"><i class="fas fa-shopping-cart"></i>
                <li class="nav-item submenu dropdown">
                  <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
                    aria-expanded="false"><i class="fas fa-user-circle me-2"></i></a>
                  <ul class="dropdown-menu">
                      <li class="nav-item"><a class="nav-link" href="/myProfile/<%= userDetails._id %>"><%= userDetails.username %></a></li>
                      <li class="nav-item"><a class="nav-link" href="/wallet/<%= userDetails._id %>">Wallet</a></li>
                      <li class="nav-item"><a class="nav-link" href="/myOrder/<%= userDetails._id %>">My Orders</a></li>
                      <li class="nav-item"><a class="nav-link" href="/logout">Log Out</a></li>
                  </ul>
                </li>
              </ul>
            </div>
          </div>
        </nav>
      </div>
    </header>
    <!-- Navbar ============================-->

    
        <!-- Menu -->

        <div class="container mt-5 pt-5">
          <div class="main-body">
              <div class="row">
                  <div class="col-lg-4">
                      <div class="card">
                          <div class="card-body">
                              <div class="d-flex flex-column align-items-center text-center">
                                  <% if (!userDetails.userImage) { %>
                                      <img src="https://icon-library.com/images/avatar-icon-images/avatar-icon-images-4.jpg"
                                          alt="<%= userDetails.username %>" class="rounded-circle p-1 bg-primary"
                                          width="110">
                                      <% }else{ %>
                                          <img src="data:image/jpeg;base64,<%= userDetails.userImage %>" alt="<%= userDetails.username %>" class="rounded-circle p-1 bg-primary" width="110px">
                                      <% } %>
                                      <div class="mt-3">
                                          <h4>
                                              <%= userDetails.username %>
                                          </h4>
                                          <p class="text-secondary mb-1">
                                              <%= userDetails.email %>
                                          </p>
                                          <div>
                                            <h6>Wallet Balance: <%= walletBalance %> INR</h6>
                                        </div>
                                      </div>
                              </div>
                              
                          </div>
                      </div>
                  </div>
                  <div class="col-lg-8">
                    <div class="card">
                        <div class="card-body mb-5"> 
                          <h4 class="mb-5">Add Funds to Your Wallet</h4>
                          <div id="error"></div>
                          <div id="paymentForm">
                            <div class="row mb-3">
                              <div class="col-sm-3">
                                  <h6 class="mb-0">Enter amount to add</h6>
                              </div>
                              <div class="col-sm-9 text-secondary">
                                  <input type="number" id="amount" class="form-control"
                                     required>
                              </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-3">
                                    <div class="col-sm-9 text-secondary">
                                        <input type="button" class="btn btn-primary px-4" value="Add Funds" id="addFundsButton">
                                    </div>
                                </div>
                            </div>
                          </div>   
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- / Menu -->

        <!-- Layout container -->
        

          <!-- Navbar -->
         

          <!-- / Navbar -->

          <!-- Content wrapper -->
          <div class="content-wrapper">
            <div class="container-xxl flex-grow-1 container-p-y">
                <h4 class="fw-bold py-3 mb-4">Wallet Transaction History</h4>
                <div class="card">
                    <h5 class="card-header">Wallet Transaction History</h5>
                    <div class="table-responsive p-3">
                        <table class="table table-dark py-3" id="example">
                            <thead>
                                <tr>
                                    <th>Type</th>
                                    <th>Amount</th>
                                    <th>Description</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody class="table-border-bottom-0">
                                <% transactions.forEach((transaction) => { %>
                                <tr>  
                                    <td><%= transaction.type %></td>
                                    <td><%= transaction.amount %></td>
                                    <td><%= transaction.description %></td>
                                    <td><%= transaction.createdAt.toLocaleDateString() %></td>
                                </tr>
                                <% }) %>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
          
          <!-- / Layout page -->

          <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script>
      document.getElementById('addFundsButton').addEventListener('click', async function(event) {

        const amountInput = document.getElementById('amount');
        const amounttrim = amountInput.value.trim();

        if (amounttrim === '') {
            // Display warning message
            document.getElementById('error').innerHTML = '<div class="alert alert-danger" role="alert">Please enter the amount to add.</div>';
            // Focus on the amount input field
            amountInput.focus();

            setTimeout(function() {
                document.getElementById('error').innerHTML = '';
            }, 3000);

            return;
        }

          event.preventDefault();
          const amount = document.getElementById('amount').value;
  
          // Create Razorpay order
          const response = await fetch('/razorpay/order', {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/json'
              },
              body: JSON.stringify({ amount })
          });
  
          const { orderId, razorpayKey } = await response.json();
  
          const options = {
              key: razorpayKey,
              amount: amount * 100, // amount in smallest currency unit (e.g., paise)
              currency: 'INR',
              name: 'Paperworm',
              description: 'Add Funds to Wallet',
              image: "../adminLogin/images/img-02.png",
              order_id: orderId,
              handler: function(response) {
                  // Payment successful, now add funds to wallet
                  addFundsToWallet(amount);
              },
              prefill: {
                  name: '<%= userDetails.username %>',
                  email: '<%= userDetails.email %>'
              },
              theme: {
                  color: '#ffb30e'
              }
          };
  
          const rzp1 = new Razorpay(options);
          rzp1.open();
      });
  
      async function addFundsToWallet(amount) {
          try {
              const response = await fetch('/addFunds', {
                  method: 'POST',
                  headers: {
                      'Content-Type': 'application/json'
                  },
                  body: JSON.stringify({ amount })
              });
  
              if (response.ok) {
                  window.location.href = '/wallet/<%= userDetails._id %>';
              } else {
                  console.error('Failed to add funds to wallet');
                  alert('Failed to add funds to wallet');
              }
          } catch (error) {
              console.error('Error adding funds to wallet:', error);
              alert('Error adding funds to wallet');
          }
      }
  </script>

       
      
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
        <script>
          $(document).ready(function () {
            $('#example').DataTable();
          });
          $('#example').DataTable({
            "searching": true
          });
        </script>
    <!-- Core JS -->
    <!-- build:js assets/vendor/js/core.js -->
    <script src="../admin/assets/vendor/libs/jquery/jquery.js"></script>
    <script src="../admin/assets/vendor/libs/popper/popper.js"></script>
    <script src="../admin/assets/vendor/js/bootstrap.js"></script>
    <script src="../admin/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>
    <script src="../admin/assets/vendor/js/menu.js"></script>
    <!-- endbuild -->
    <!-- Vendors JS -->
    <script src="../admin/assets/vendor/libs/apex-charts/apexcharts.js"></script>
    <!-- Main JS -->
    <script src="../admin/assets/js/main.js"></script>
    <!-- Page JS -->
    <script src="../admin/assets/js/dashboards-analytics.js"></script>
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
  </body>
</html>